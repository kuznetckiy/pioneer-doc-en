Бортовой модуль навигации в помещении
=====================================


.. image:: /_static/images/drone_indor_module.png
	:align: center

Модуль входит в комплект системы навигации в помещении вместе с блоком управления и четырьмя ультразвуковыми излучателями. 
Он монтируется на основной плате "Пионера" сверху с помощью 4-х винтов М3.

Модуль оснащен двумя микрофонами, которые позволяют контроллеру оценивать время прихода и разность фаз сигналов с излучателей. Далее происходит синхронизация с блоком управления по радиоканалу и определяется точное положение квадрокоптера в пространстве, а также его скорость.

Для работы модуля необходимо расположить включенный квадрокоптер в зоне действия ультразвуковых излучателей.

**Дополнительно:** `Навигация в помещении`_

.. _Навигация в помещении: ../indoor_nav.html

Полет в системе навигации может осуществляться как в ручном режиме, так и по заранее загруженной программе. Пример такой программы - ниже. Выполняя её, "Пионер" взлетает, набирает высоту 1.2 м, летит в угол полетной зоны с координатами (0:0), затем в точку с координатами (1:1) и приземляется. Чтобы `загрузить программу на "Пионер"`_, используйте Pioneer Station.

.. _загрузить программу на "Пионер": ../programming/pioneer_station/pioneer_station_upload.html



::

 -- переменная текущего состояния
 local curr_state = "PREPARE_FLIGHT"

  
 -- таблица функций, вызываемых в зависимости от состояния
 action = {
    ["PREPARE_FLIGHT"] = function(x)
            Timer.callLater(2, function () 
            ap.push(Ev.MCE_TAKEOFF) -- через 2 секунды отправляем команду автопилоту на взлет
            curr_state = "FLIGHT_TO_FIRST_POINT" -- переход в следующее состояние
        end)
    end,
    ["FLIGHT_TO_FIRST_POINT"] = function (x) 
            Timer.callLater(2, function ()
            ap.goToLocalPoint(0, 0, 1.2) -- отправка команды автопилоту на полет к точке с координатами (0 м, 0 м, 1,2 м)
            curr_state = "FLIGHT_TO_SECOND_POINT" -- переход в следующее состояние
        end) 
    end,
    ["FLIGHT_TO_SECOND_POINT"] = function (x) 
            Timer.callLater(2, function ()
            ap.goToLocalPoint(1, 1, 1.2) -- отправка команды автопилоту на полет к точке с координатами (1 м, 1 м, 1,2 м)
            curr_state = "PIONEER_LANDING" -- переход в следующее состояние
        end)
    end,
    ["PIONEER_LANDING"] = function (x) 
            Timer.callLater(2, function () 
            ap.push(Ev.MCE_LANDING) -- отправка команды автопилоту на посадку
        end)
    end
 }
 

 -- включаем светодиод (красный цвет)
 changeColor(colors[1])
 -- запускаем одноразовый таймер на 2 секунды, а когда он закончится, выполняем первую функцию из таблицы (подготовка к полету)
 Timer.callLater(2, function () action[curr_state]() end)

   
Прошивка модуля навигации
---------------------------

Для обновления прошивки модуля на вашем компьютере должна быть установлена программа Pioneer Station. В окне программы выберите пункт меню "обновление прошивки" и следуйте указаниям помощника.
При переходе к пункту "Выбор устройства" в списке будет отображаться не только базовая плата квадрокоптера PioneerBase, но и модуль навигации ModuleUSNav. Поставьте галочку напротив модуля и нажмите "Далее".

.. image:: /_static/images/nav_upd.png
    :align: center

При выборе источника прошивки рекомендуется "встроенный" - это последняя актуальная версия, входящая в сборку программы. 
Если версия модуля не определяется автоматически, прочтите маркировку на обратной стороне платы и выберите соответствующую прошивку из доступных в папке Pioneer Station.
Дождитесь окончания прошивки. После этого квадрокоптер перезагрузится в обычный режим.